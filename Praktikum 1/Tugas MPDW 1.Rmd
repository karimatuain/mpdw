# Panggil library yang digunakan
```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
```

## Impor Data

Data yang digunakan adalah data laporan mingguan rata-rata Harga Komoditas Telur di seluruh provinsi di Indonesia dalam 139 pekan (pekan 1 Januari 2021 hingga pekan 4 Agustus 2023)
```{r}
library(rio)
data1 <- import("https://raw.githubusercontent.com/karimatuain/mpdw/main/Praktikum%201/Data%20MPDW%201.csv")
data1
str(data1)
dim(data1)
```

#Mengubah data agar terbaca sebagai data deret waktu dengan fungsi `ts()` .

```{r}
data1.ts <- ts(data1$Harga)
data1.ts
```

#Menampilkan ringkasan data

```{r}
summary(data1.ts)
```

#Membuat plot data deret waktu

```{r}
ts.plot(data1.ts, xlab="Periode Waktu (Mingguan)", ylab="Harga Telur", 
        main = "Perkembangan Harga Telur per Minggu (1/1/2021 - 31/8/23)")
points(data1.ts)
```

#membagi data latih dan data uji (data latih 80%, data uji 20%)
```{r}
training_ma <- data1[1:111,]
training_ma
testing_ma <- data1[112:139,]
testing_ma
train_ma.ts <- ts(training_ma$Harga)
test_ma.ts <- ts(testing_ma$Harga)
```

#Eksplorasi dengan GGPLOT
```{r}
library(ggplot2)
ggplot() + 
  geom_line(data = training_ma, aes(x = Periode, y = Harga, col = "Data Latih")) +
  geom_line(data = testing_ma, aes(x = Periode, y = Harga, col = "Data Uji")) +
  labs(x = "Periode Waktu (Mingguan)", y = "Harga Telur", color = "Legend") +
  scale_colour_manual(name="Keterangan:", breaks = c("Data Latih", "Data Uji"),
                      values = c("black","red")) + 
  theme_bw() + theme(legend.position = "right",
                     plot.caption = element_text(hjust=0.5, size=12))
```
# Percobaan Pemulusan dengan Single Moving Average (SMA)

Ide dasar dari Single Moving Average (SMA) adalah data suatu periode dipengaruhi oleh data periode sebelumnya. Metode pemulusan ini cocok digunakan untuk pola data stasioner atau konstan. Prinsip dasar metode pemulusan ini adalah data pemulusan pada periode ke-t merupakan rata rata dari m buah data pada periode ke-t hingga periode ke (t-m+1). Data pemulusan pada periode ke-t selanjutnya digunakan sebagai nilai peramalan pada periode ke t+1

Pemulusan menggunakan metode SMA dilakukan dengan fungsi `SMA()`. Dalam hal ini akan dilakukan pemulusan dengan parameter `m=4`.

```{r}
data.sma<-SMA(train_ma.ts, n=4)
data.sma
```
# forecast 1 periode ke depan
Data pemulusan pada periode ke-t selanjutnya digunakan sebagai nilai peramalan pada periode ke t+1 sehingga hasil peramalan 1 periode kedepan adalah sebagai berikut.

```{r}
data.ramal<-c(NA,data.sma)
data.ramal 
```

# forecast 28 periode
Selanjutnya akan dilakukan peramalan sejumlah data uji yaitu 28 periode. Pada metode SMA, hasil peramalan 28 periode ke depan akan bernilai sama dengan hasil peramalan 1 periode kedepan. Dalam hal ini akan dilakukan penggabungan data aktual train, data hasil pemulusan dan data hasil ramalan 28 periode kedepan.

```{r}
data.gab<-cbind(aktual=c(train_ma.ts,rep(NA,28)),pemulusan=c(data.sma,rep(NA,28)),ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],27)))
data.gab 
```

#Plot hasil peramlan 
Adapun plot data deret waktu dari hasil peramalan yang dilakukan adalah sebagai berikut.

```{r}
ts.plot(data1.ts, xlab="Periode Waktu (Mingguan)", ylab="Harga Telur", main= "SMA N=4 Data Harga Telur")
points(data1.ts)
lines(data.gab[,2],col="blue",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","blue","red"), cex=0.5)
```

#Menghitung nilai keakuratan data latih (SMA)

Selanjutnya perhitungan akurasi dilakukan dengan ukuran akurasi *Sum Squares Error* (SSE), *Mean Square Error* (MSE) dan *Mean Absolute Percentage Error* (MAPE). Perhitungan akurasi dilakukan baik pada data latih maupun pada data uji.

```{r}
error_train.sma = train_ma.ts-data.ramal[1:length(train_ma.ts)]
SSE_train.sma = sum(error_train.sma[5:length(train_ma.ts)]^2)
MSE_train.sma = mean(error_train.sma[5:length(train_ma.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[5:length(train_ma.ts)]/train_ma.ts[5:length(train_ma.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 4")
akurasi_train.sma
```

Dalam hal ini nilai MAPE data latih pada metode pemulusan SMA lebih dari 2%, nilai ini dapat dikategorikan sebagai nilai akurasi yang ......... Selanjutnya dilakukan perhitungan nilai MAPE data uji pada metode pemulusan SMA.


#Menghitung nilai keakuratan data uji
```{r}
error_test.sma = test_ma.ts-data.gab[112:139,3]
SSE_test.sma = sum(error_test.sma^2)
MSE_test.sma = mean(error_test.sma^2)
MAPE_test.sma = mean(abs((error_test.sma/test_ma.ts*100)))

akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 4")
akurasi_test.sma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.


#Percobaan pemulusan dengan Motode Double Moving Average (DMA)
Plot data menunjukkan adanya trend yang cenderung naik sehingga metode pemulusan Double Moving Average (DMA) dirasa lebih cocok digunakan. Proses pemulusan dengan rata rata dalam metode ini dilakukan sebanyak 2 kali.

```{r}
dma <- SMA(data.sma, n = 4)
At <- 2*data.sma - dma
Bt <- 2/(4-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal<- c(NA, data.dma)

t = 1:28
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab <- cbind(aktual = c(train_ma.ts,rep(NA,28)), pemulusan1 = c(data.sma,rep(NA,28)),pemulusan2 = c(data.dma, rep(NA,28)),At = c(At, rep(NA,28)), Bt = c(Bt,rep(NA,28)),ramalan = c(data.ramal, f[-1]))
data.gab

```

#Hasil pemulusan menggunakan metode DMA divisualisasikan sebagai berikut

```{r}
ts.plot(data1.ts, xlab="Periode Waktu (Mingguan)", ylab="Harga Telur", main= "DMA N=4 Data Hrga Telur")
points(data1.ts)
lines(data.gab[,3],col="green",lwd=2)
lines(data.gab[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)

```
#Menghitung nilai keakuratan data latih (DMA)
Selanjutnya perhitungan akurasi dilakukan baik pada data latih maupun data uji. Perhitungan akurasi dilakukan dengan ukuran akurasi SSE, MSE dan MAPE.

```{r}
error_train.dma = train_ma.ts-data.ramal[1:length(train_ma.ts)]
SSE_train.dma = sum(error_train.dma[8:length(train_ma.ts)]^2)
MSE_train.dma = mean(error_train.dma[8:length(train_ma.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[8:length(train_ma.ts)]/train_ma.ts[8:length(train_ma.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 4")
akurasi_train.dma
```

Perhitungan akurasi pada data latih menggunakan nilai MAPE menghasilkan nilai MAPE yang kurang dari 10% sehingga dikategorikan sangat baik. Selanjutnya, perhitungan nilai akurasi dilakukan pada data uji.

```{r}
#Menghitung nilai keakuratan data uji
error_test.dma = test_ma.ts-data.gab[112:139,6]
SSE_test.dma = sum(error_test.dma^2)
MSE_test.dma = mean(error_test.dma^2)
MAPE_test.dma = mean(abs((error_test.dma/test_ma.ts*100)))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 4")
akurasi_test.dma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

Pada data latih, metode SMA lebih baik dibandingkan dengan metode DMA, sedangkan pada data uji, metode DMA lebih baik dibandingkan SMA

#DES

### DES

Metode pemulusan *Double Exponential Smoothing* (DES) digunakan untuk data yang memiliki pola tren. Metode DES adalah metode semacam SES, hanya saja dilakukan dua kali, yaitu pertama untuk tahapan 'level' dan kedua untuk tahapan 'tren'. Pemulusan menggunakan metode ini akan menghasilkan peramalan tidak konstan untuk periode berikutnya.

Pemulusan dengan metode DES kali ini akan menggunakan fungsi `HoltWinters()` . Jika sebelumnya nilai argumen `beta` dibuat `FALSE` , kali ini argumen tersebut akan diinisialisasi bersamaan dengan nilai `alpha` .

```{r}
#Lamda=0.2 dan gamma=0.2
des.1<- HoltWinters(train.ts, gamma = FALSE, beta = 0.2, alpha = 0.2)
plot(des.1)

#ramalan
ramalandes1<- forecast(des.1, h=10)
ramalandes1

#Lamda=0.6 dan gamma=0.3
des.2<- HoltWinters(train.ts, gamma = FALSE, beta = 0.3, alpha = 0.6)
plot(des.2)

#ramalan
ramalandes2<- forecast(des.2, h=10)
ramalandes2
```

Untuk mendapatkan nilai parameter optimum dari DES, argumen `alpha` dan `beta` dapat dibuat `NULL` seperti berikut.

```{r}
#Lamda dan gamma optimum
des.opt<- HoltWinters(train_ma.ts, gamma = FALSE)
des.opt
plot(des.opt)

#ramalan
ramalandesopt<- forecast(des.opt, h=28)
ramalandesopt
```

Selanjutnya akan dilakukan perhitungan akurasi pada data latih maupun data uji dengan ukuran akurasi SSE, MSE dan MAPE.

#### Akurasi Data Latih

```{r}
#Akurasi Data Training
ssedes.train<-des.opt$SSE
msedes.train<-ssedes.train/length(train_ma.ts)
sisaandes<-ramalandesopt$residuals
head(sisaandes)

mapedes.train <- sum(abs(sisaandes[3:length(train_ma.ts)]/train_ma.ts[3:length(train_ma.ts)])
                      *100)/length(train_ma.ts)

akurasides.opt <- matrix(c(ssedes.train,msedes.train,mapedes.train))
row.names(akurasides.opt)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.opt) <- c("Akurasi (optimum) lambda=0.48 dan gamma=0.03")
akurasides.opt
```
#### Akurasi Data Uji

```{r}
selisihdesopt<-ramalandesopt$mean-testing_ma$Harga
selisihdesopt

SSEtestingdesopt<-sum(selisihdesopt^2)
MSEtestingdesopt<-SSEtestingdesopt/length(testing_ma$Harga)
MAPEtestingdesopt<-sum(abs(selisihdesopt/testing_ma$Harga)*100)/length(testing_ma$Harga)

akurasitestingdes <-
  matrix(c(SSEtestingdesopt,MSEtestingdesopt,MAPEtestingdesopt),
         nrow=3,ncol=1)
row.names(akurasitestingdes)<- c("SSE", "MSE", "MAPE")
colnames(akurasitestingdes) <- c("DES optimum")
akurasitestingdes
```

